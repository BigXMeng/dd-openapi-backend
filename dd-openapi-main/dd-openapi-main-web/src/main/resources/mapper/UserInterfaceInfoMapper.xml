<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dd.openapi.main.web.mapper.UserInterfaceInfoMapper">

    <select id="pageUserInterfaceInfoDTO" parameterType="map" resultType="com.dd.openapi.main.web.model.dto.UserInterfaceInfoDTO">
        SELECT
        ii.*,
        uii.totalNum,
        uii.leftNum
        FROM
        `interface_info` ii
        LEFT JOIN `user_interface_info` uii ON ii.id = uii.interfaceInfoId
        <where>
            <if test="params.status != null">
                AND ii.status = #{params.status}
            </if>
            <if test="params.method != null and params.method != ''">
                AND ii.method = #{params.method}
            </if>
            <if test="params.description != null and params.description != ''">
                AND ii.description LIKE CONCAT('%', #{params.description}, '%')
            </if>
            <if test="params.name != null and params.name != ''">
                AND ii.name LIKE CONCAT('%', #{params.name}, '%')
            </if>
            <if test="params.userAccount != null and params.userAccount != ''">
                AND ii.userAccount LIKE CONCAT('%', #{params.userAccount}, '%')
            </if>
            <if test="params.url != null and params.url != ''">
                AND ii.url LIKE CONCAT('%', #{params.url}, '%')
            </if>
        </where>
        ORDER BY
        ii.updateTime DESC
    </select>

    <select id="interfaceInvokeTop3InfoDTO"
            resultType="com.dd.openapi.main.web.model.dto.InterfaceInvokeTop3InfoDTO">
        SELECT
            a.interfaceInfoId as interfaceInfoId,
            a.invokedTotalNum as invokedTotalNum,
            ii.`name` as interfaceName
        FROM
            (SELECT interfaceInfoId, sum(totalNum) as invokedTotalNum
             FROM `user_interface_info`
             GROUP BY interfaceInfoId
             ORDER BY invokedTotalNum desc
                 LIMIT 3) a join interface_info ii ON a.interfaceInfoId = ii.id
    </select>
</mapper>
